<?xml version="1.0" encoding="UTF-8"?>
<launch>
	<arg name="measure_localization_positions" default="0" />
	<arg name="measure_localization_error" default="1" />
	<arg name="measure_localization_corrections" default="0" />
	<arg name="measure_localization_fitness_and_outliers" default="0" />
	<arg name="measure_localization_computation_time" default="1" />
	<arg name="measure_localization_diagnostics" default="0" />
	<arg name="move_robot_on_path" default="1" />
	<arg name="robot_initial_x" default="0.0" />
	<arg name="robot_initial_y" default="0.0" />
	<arg name="robot_initial_z" default="0.0" />
	<arg name="robot_initial_yaw" default="0.0" />


	<node pkg="dynamic_robot_localization" type="drl_pose_to_tf_publisher_node" name="drl_pose_to_tf_publisher_node_ground_truth" ns="dynamic_robot_localization" output="screen">
		<param name="publish_rate" type="double" value="400.0" />
		<param name="pose_with_covariance_stamped_topic" type="str" value="" />
		<param name="odometry_topic" type="str" value="/base_pose_ground_truth" />
		<param name="map_frame_id" type="str" value="map_ground_truth" />
		<param name="odom_frame_id" type="str" value="odom" />
		<param name="base_link_frame_id" type="str" value="base_footprint" />
		<param name="invert_tf_transform" type="bool" value="true" />
		<param name="invert_tf_hierarchy" type="bool" value="true" />
		<param name="transform_pose_to_map_frame_id" type="bool" value="false" />
		<param name="initial_x" type="double" value="$(arg robot_initial_x)" />
		<param name="initial_y" type="double" value="$(arg robot_initial_y)" />
		<param name="initial_z" type="double" value="$(arg robot_initial_z)" />
		<param name="initial_yaw" type="double" value="$(arg robot_initial_yaw)" />
	</node>

	<node pkg="robot_localization_tools" type="rlt_robot_localization_error_node" name="rlt_robot_localization_error" ns="dynamic_robot_localization" output="screen">
		<param name="gazebo_ground_truth_link" type="str" value="guardian::base_footprint" />
		<param name="map_ground_truth_frame_id" type="str" value="map_ground_truth" />
		<param name="invert_tf_from_map_ground_truth_frame_id" type="bool" value="false" />
		<param name="pose_error_publish_topic" type="str" value="localization_error" />
		<param name="use_roll_pitch_yaw_angles" type="bool" value="true" />
		<param name="use_degrees_in_angles" type="bool" value="true" />
		<param name="use_millimeters_in_distances" type="bool" value="true" />
	</node>

	
	<group if="$(arg measure_localization_positions)">
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_x_positions" output="screen" args="/gazebo/model_states/pose[2]/position/x /initialpose/pose/pose/position/x" />
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_y_positions" output="screen" args="/gazebo/model_states/pose[2]/position/y /initialpose/pose/pose/position/y" />
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_z_positions" output="screen" args="/gazebo/model_states/pose[2]/position/z /initialpose/pose/pose/position/z" />
	</group>

	<group if="$(arg measure_localization_error)">
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_error_position" output="screen" args="/dynamic_robot_localization/localization_error/pose/position/x:y:z" />
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_error_orientation" output="screen" args="/dynamic_robot_localization/localization_error/pose/orientation/x:y:z" />
	</group>
	
	<group if="$(arg measure_localization_corrections)">
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_pose_correction_translation" output="screen" args="/dynamic_robot_localization/localization_detailed/pose_corrections/position/x:y:z" />
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_pose_correction_rotation" output="screen" args="/dynamic_robot_localization/localization_detailed/pose_corrections/orientation/x:y:z" />
	</group>

	<group if="$(arg measure_localization_fitness_and_outliers)">
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_aligment_fitness" output="screen" args="/dynamic_robot_localization/localization_detailed/aligment_fitness" />
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_outlier_percentage" output="screen" args="/dynamic_robot_localization/localization_detailed/outlier_percentage" />
	</group>

	<group if="$(arg measure_localization_computation_time)">
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_times" output="screen"
			args="/dynamic_robot_localization/localization_times/global_time:filtering_time:surface_normal_estimation_time:keypoint_selection_time:featurecloud_registration_time:pointcloud_registration_time:outlier_detection_time:transformation_validators_time" />
	</group>

	<group if="$(arg measure_localization_diagnostics)">
		<node pkg="rqt_plot" type="rqt_plot" name="rqt_plot_localization_diagnostics" output="screen"
			args="/dynamic_robot_localization/diagnostics/number_points_reference_pointcloud:number_points_reference_pointcloud_after_filtering:number_keypoints_reference_pointcloud:number_points_ambient_pointcloud:number_points_ambient_pointcloud_after_filtering:number_keypoints_ambient_pointcloud" />
	</group>
</launch>